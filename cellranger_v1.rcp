Bootstrap: docker
From: ubuntu

%labels
    Maintainer Hang(Dylan) Yang	
    Image_Name CellRanger
    Image_Version CellRanger_3.1.0
    
%environment
  export PATH=$PATH:/cellranger/cellranger-3.1.0

%post
  export DEBIAN_FRONTEND=noninteractive
  apt-get update
  apt-get install -y wget \
                     rpm2cpio \

  #--------------------------------------------------------------------------------
  # install cellranger and reference genome
  mkdir -p /cellranger
  cd /cellranger 
  wget -O bcl2fastq_installer.tar "https://files.softwaredownloads.illumina.com/e8ed3335-5201-48ff-a2bc-db4bfb792c85/bcl2fastq2-v2-20-0-linux-x86-64.zip?Expires=1589561958&Policy=eyJTdGF0ZW1lbnQiOlt7IlJlc291cmNlIjoiaHR0cHM6Ly9maWxlcy5zb2Z0d2FyZWRvd25sb2Fkcy5pbGx1bWluYS5jb20vZThlZDMzMzUtNTIwMS00OGZmLWEyYmMtZGI0YmZiNzkyYzg1L2JjbDJmYXN0cTItdjItMjAtMC1saW51eC14ODYtNjQuemlwIiwiQ29uZGl0aW9uIjp7IkRhdGVMZXNzVGhhbiI6eyJBV1M6RXBvY2hUaW1lIjoxNTg5NTYxOTU4fX19XX0_&Signature=AvdpVEnArd2smW6nK0REHfE6dmzsb0I~xmC41hN2pC~3xLjGDt6n6fMyCB-qS4DEc6tqGBYALoO6AGrwBmRkgt0273-m6xsKBcpJ-Ioctxk7TUVBn9lKtAlwJ1iM9jGQQi~f~bpYx4QfSn--NaXrGUWPF~N0nKMt7X9MH-loBXp-05x7oOyqH~91~2rnTG9BlSBNnsW0HpKcJlnl~UpAyu-juun1d-a7J-u2EIxkmDEjeQsJwqvV6Ia9fjwm1AG1gKOwI9roWkfYCKyx20VedfBLPIS7cfICV0Kne1jHiCzp0RpFwlWSB09jRbozs5C7gtwI~LVFc-CgWY0p57fCbA__&Key-Pair-Id=APKAJO3UYWPXK4A26FPQ"
  tar -xvf bcl2fastq_installer.tar
  rpm2cpio ./bcl2fastq2-v2.20.0.422-Linux-x86_64.rpm | cpio -idmv
  rm bcl2fastq_installer.tar
 
  wget -O cellranger-3.1.0.tar.gz "http://cf.10xgenomics.com/releases/cell-exp/cellranger-3.1.0.tar.gz?Expires=1589604063&Policy=eyJTdGF0ZW1lbnQiOlt7IlJlc291cmNlIjoiaHR0cDovL2NmLjEweGdlbm9taWNzLmNvbS9yZWxlYXNlcy9jZWxsLWV4cC9jZWxscmFuZ2VyLTMuMS4wLnRhci5neiIsIkNvbmRpdGlvbiI6eyJEYXRlTGVzc1RoYW4iOnsiQVdTOkVwb2NoVGltZSI6MTU4OTYwNDA2M319fV19&Signature=RvDY8Luw8S8f3DGRrXIBdq6lQH6kBj8k33kveuinTHe3odeMw95tSiRLiNiFex4r1Omi-XSf9LSKmYW-hdGnmCgrBSS4pMtFR8tCFCv752c29bXgFWCkJHNJhMEoAUCr7uqaxQ3OpYlVVaNtEdUGj7obF2gEUdXwVB01Kr4bkNnILJ7nOu-Qnis8q-kor8aJhHXV-F9i2Qpgp1EPRGF2S1kNEZql1l10GhRLyqYWI~yn5BKTMeqe2ihVOD4DjSouOXx2ZRg1LEeJzWU9-yrQ3ULUR6sNUIjKfmrciruobNnlF1hlyI9DHppdyh6CoSKhV0GKI0T7LEu90y7ufsebxg__&Key-Pair-Id=APKAI7S6A5RYOXBWRPDA"
  wget http://cf.10xgenomics.com/supp/cell-exp/refdata-cellranger-GRCh38-3.0.0.tar.gz
  wget http://cf.10xgenomics.com/supp/cell-vdj/refdata-cellranger-vdj-GRCh38-alts-ensembl-3.1.0.tar.gz
  tar -xvzf refdata-cellranger-GRCh38-3.0.0.tar.gz
  tar -xvzf cellranger-3.1.0.tar.gz
  tar -xvzf refdata-cellranger-vdj-GRCh38-alts-ensembl-3.1.0.tar.gz
  rm refdata-cellranger-GRCh38-3.0.0.tar.gz
  rm cellranger-3.1.0.tar.gz
  rm refdata-cellranger-vdj-GRCh38-alts-ensembl-3.1.0.tar.gz
   
# Create directories to bind-mount data and reference genome and to store output
  mkdir -p /output 
  mkdir -p /data 
  mkdir -p /work/scratch
